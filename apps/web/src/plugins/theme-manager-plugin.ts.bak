/**
 * Theme Manager Plugin
 * Provides interface themes (Light/Dark)
 */

import type { IPluginContext, PluginManifest } from '@bigmind/plugin-system';
import { getAllInterfaceThemes, getTheme, applyThemeToDocument } from '../themes/colorThemes';

export const manifest: PluginManifest = {
  id: 'com.bigmind.theme-manager',
  name: 'Theme Manager',
  version: '1.0.0',
  description: 'GÃ¨re les thÃ¨mes d\'interface Light et Dark pour personnaliser l\'apparence de BigMind',
  author: {
    name: 'BigMind Team',
    email: 'team@bigmind.com',
  },
  main: 'theme-manager-plugin.js',
  icon: 'ğŸŒ“',
  category: 'theme',
  tags: ['theme', 'dark-mode', 'light-mode', 'appearance', 'ui'],
  license: 'MIT',
  bigmindVersion: '^1.0.0',

  // Features
  features: [
    {
      label: 'Mode Light',
      description: 'Interface claire et lumineuse pour un environnement bien Ã©clairÃ©',
      icon: 'â˜€ï¸',
    },
    {
      label: 'Mode Dark',
      description: 'Interface sombre pour rÃ©duire la fatigue oculaire en faible luminositÃ©',
      icon: 'ğŸŒ™',
    },
    {
      label: 'Variables CSS globales',
      description: 'Tous les composants s\'adaptent automatiquement au thÃ¨me sÃ©lectionnÃ©',
      icon: 'ğŸ¨',
    },
  ],

  // Changelog
  changelog: [
    {
      version: '1.0.0',
      date: '2025-01-28',
      changes: [
        {
          type: 'added',
          description: 'ThÃ¨me Light avec palette claire',
        },
        {
          type: 'added',
          description: 'ThÃ¨me Dark avec palette sombre',
        },
        {
          type: 'added',
          description: 'Application automatique des variables CSS',
        },
        {
          type: 'added',
          description: 'Persistance du thÃ¨me sÃ©lectionnÃ©',
        },
      ],
    },
  ],

  // Hooks
  hooks: {
    listens: ['theme.changed'], // Ã‰coute les changements de thÃ¨me
    emits: [], // N'Ã©met pas d'Ã©vÃ©nements
  },

  // UI Contributions
  uiContributions: {
    commands: ['themes.list', 'themes.get', 'themes.apply'],
    menus: ['Settings > Appearance > Theme'],
    panels: [],
    settings: true,
  },

  permissions: [],
};

export async function activate(context: IPluginContext): Promise<void> {
  console.log('ğŸŒ“ [Theme Manager] Plugin activÃ©');

  // Register command to list all themes
  context.commands.registerCommand('themes.list', async () => {
    return getAllInterfaceThemes();
  });

  // Register command to get a specific theme
  context.commands.registerCommand('themes.get', async (themeId: string) => {
    const theme = getTheme(themeId);
    if (!theme) {
      throw new Error(`Theme "${themeId}" not found`);
    }
    return theme;
  });

  // Register command to apply a theme
  context.commands.registerCommand('themes.apply', async (themeId: string) => {
    const theme = getTheme(themeId);
    if (!theme) {
      throw new Error(`Theme "${themeId}" not found`);
    }

    applyThemeToDocument(theme);
    console.log(`ğŸŒ“ [Theme Manager] Theme "${theme.name}" applied`);

    return theme;
  });

  // Listen to theme changes
  context.hooks.registerAction('theme.changed', async (data: any) => {
    console.log(`ğŸŒ“ [Theme Manager] Theme changed:`, data);
  });

  const themeCount = getAllInterfaceThemes().length;
  console.log(`ğŸŒ“ [Theme Manager] ${themeCount} thÃ¨mes disponibles`);
}

export async function deactivate(): Promise<void> {
  console.log('ğŸŒ“ [Theme Manager] Plugin dÃ©sactivÃ©');
}
